filegroup(
    name = "everything_x",
    srcs = glob([
        "**/*",
    ]),
)

genrule(
    name = "configure",
    srcs = [":configure.py"],
    cmd = "cp '$<' '$@'",
    outs = ["_configure.py"],
)

genrule(
    name = "build_seastar",
    srcs = [":everything_x"],
    tools = [":configure"],
    cmd = "cd `dirname $(execpath :configure)` && ./_configure.py --mode=release && ninja-build -C build/release/ seastar && cp build/release/libseastar.a ../../$@",
    outs = ["libseastar.a"],
)

cc_library(
    name = "seastar_lib",
    data = [":build_seastar"],
    visibility = ["//visibility:public"],
)
